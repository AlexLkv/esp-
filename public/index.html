<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Комната для ESP32-C3</title>
</head>
<body>
  <h1>Подключение ESP32-C3 по Bluetooth</h1>
  <button id="connect">Подключиться к ESP32-C3</button>
  <button id="press">Нажать кнопку</button>

  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // Переменные для работы с Bluetooth
    let device, server, service, characteristic;

    // Функция для подключения к ESP32-C3
    document.getElementById('connect').addEventListener('click', async () => {
      try {
        device = await navigator.bluetooth.requestDevice({
          // Укажите здесь нужные UUID сервиса. Например, если вы используете сервис с определённым UUID:
          filters: [{ services: ['your_service_uuid'] }]
        });
        server = await device.gatt.connect();
        // Получаем нужный сервис по его UUID
        service = await server.getPrimaryService('your_service_uuid');
        // Получаем характеристику для управления светодиодом
        characteristic = await service.getCharacteristic('your_characteristic_uuid');
        console.log('Подключено к ESP32-C3');
      } catch (error) {
        console.error('Ошибка подключения Bluetooth:', error);
      }
    });

    // Обработка нажатия кнопки на клиенте
    document.getElementById('press').addEventListener('click', async () => {
      // Отправляем событие на сервер
      socket.emit('buttonPress');
      // Дополнительно можно отправить команду на свой ESP32-C3 (например, включить светодиод локально)
      if (characteristic) {
        // Отправляем команду (пример: значение 1 для включения светодиода)
        try {
          await characteristic.writeValue(new Uint8Array([1]));
          console.log('Команда отправлена на локальный ESP32-C3');
        } catch (error) {
          console.error('Ошибка при отправке команды на ESP32-C3:', error);
        }
      }
    });

    // Получение события от сервера для управления светодиодом удалённого ESP32-C3
    socket.on('toggleLED', async () => {
      if (characteristic) {
        try {
          // Пример: отправляем команду для включения светодиода
          await characteristic.writeValue(new Uint8Array([1]));
          console.log('Удалённый светодиод включён');
        } catch (error) {
          console.error('Ошибка при переключении светодиода на удалённом ESP32-C3:', error);
        }
      } else {
        console.warn('Не подключён Bluetooth-устройство');
      }
    });
  </script>
</body>
</html>
