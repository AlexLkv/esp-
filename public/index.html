<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Комната для ESP32-C3</title>
</head>
<body>
  <h1>Подключение ESP32-C3 по Bluetooth</h1>
  <button id="connect">Подключиться к ESP32-C3</button>
  <button id="press">Нажать кнопку</button>

  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // Переменные для работы с Bluetooth
    let device, server, service, characteristic;

    // Функция для подключения к ESP32-C3
    document.getElementById('connect').addEventListener('click', async () => {
      try {
        device = await navigator.bluetooth.requestDevice({
          // Укажите здесь нужный UUID сервиса
          filters: [{ services: ['your_service_uuid'] }]
        });
        server = await device.gatt.connect();
        service = await server.getPrimaryService('your_service_uuid');
        characteristic = await service.getCharacteristic('your_characteristic_uuid');
        console.log('Подключено к ESP32-C3');
      } catch (error) {
        console.error('Ошибка подключения Bluetooth:', error);
      }
    });

    // Отправка события на сервер при нажатии кнопки
    document.getElementById('press').addEventListener('click', async () => {
      socket.emit('buttonPress');
      if (characteristic) {
        try {
          await characteristic.writeValue(new Uint8Array([1]));
          console.log('Команда отправлена на локальный ESP32-C3');
        } catch (error) {
          console.error('Ошибка при отправке команды на ESP32-C3:', error);
        }
      }
    });

    // Получение команды от сервера для управления светодиодом на удалённом устройстве
    socket.on('toggleLED', async () => {
      if (characteristic) {
        try {
          await characteristic.writeValue(new Uint8Array([1]));
          console.log('Удалённый светодиод включён');
        } catch (error) {
          console.error('Ошибка при переключении светодиода на удалённом ESP32-C3:', error);
        }
      } else {
        console.warn('Bluetooth-устройство не подключено');
      }
    });
  </script>
</body>
</html>
